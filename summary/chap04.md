## 4장

- 테스트를 읽은 프로그래머는 코드가 <b>해야 할 일</b>을 이해할 수 있어야 한다.
- 테스트를 실행한 후에는 코드가 실제로 <b>한 일</b>이 무엇인지 말할 수 있어야 한다.
- 테스트의 핵심인 단언문은 대상 코드의 올바른 동작을 규정한다
  - 테스트의 성패를 판별하는 것은 단언문이다.
  - 단언문을 제대로 작성하지 않으면 테스트의 의도를 파악하기 힘들다.

### 기본 타입 단언
기본 타입 단언(Primitive Assertions)이란 단언하려는 이유나 의도가 의미를 알 수 없는 단어나 숫자에 가려진 상황을 말한다.

#### 예시
그렙(grep) 유틸리티를 테스트하는 코드

```java
@Test
public void outputHasLineNumbers(){
    ...
    // 단언문을 이해하려면 불필요한 두뇌 활동이 필요하다.
    // 추상화 수준이 낮다.
    assertTrue(out.indexOf("test.txt:1 1st match") != -1)
}
```

```java
// 인덱스나 매직 넘버인 -1를 사용하는 건 개념을 잘못 추상화한 예다.
asssertThat(out.indexOf("test.txt:1 1st match"), is(not(-1)));
```

```java
// indexOf에서 추상화 수준을 한 단계 높인 contains 사용
assertTrue(out.contains("test.txt:1 1st match"));
```

```java
// assertThat과 contains 사용
assertThat(out.contains("test.txt:1 1st match"), equals(true));
```

```java
// 햄크레스트 매처 사용
assertThat(out, containsString("test.txt:1 1st match"));
```

취향에 맞는 방향을 택해서 단언을 하면 된다. 단, 검사하려는 기능과 단언문을 같은 언어와 어휘로 표현해야 한다.

#### 정리
텍스트에서 !=나 == 등의 비교문을 사용하는 단언문을 발견하면 추상화 수준이 적절한지 되짚어보라.

단언문을 즉시 이해할 수 없다면 기본 타입 단언에 해당하며 리팩토링 대상이 될 가능성이 높다.

### 광역 단언
광역 단언(Hyperassertion)은 범위가 넓어서 어느 하나만 잘못되어 바로 실패하게 되고, 본래 의도했던 것도 그 광활한 검증 범위에 묻혀 희석된다.

#### 개선 방법
- 본질과 관련 없는 세부 내용을 찾아 테스트에서 제거한다.
  - 책의 예시) 테스트를 위한 로그 내용의 라인 수를 줄인다. 테스트 목적을 이룰 수 있는 만큼의 정보만 있으면 된다.
- 테스트를 나눠라
  - 세분화된 주제에 충실한 테스트면 실패했을 때 문제의 근본 원인을 빠르게 찾을 수 있다.

#### 정리
광역 단언은 대상을 너무 크게 묶어서 모든걸 비교하려다 보니 너무 쉽게 망가져 버린다.

광역 단언은 프로그래머가 테스트의 의도와 핵심을 파악하는 데도 방해된다.(범위가 커서 테스트 코드를 분석해야 함)

### 비트 단언
비트 단언(Bitwise Assertion)은 기본 타입 단언의 특수한 형태다.

추상화 수준이 너무 낮아서 테스트 의도나 의미를 파악하기 어렵다.

#### 개선 방법
비트 연산자를 부울 연산자(Boolean operation)로 교체해서 기대하는 결과를 하나씩 명확하게 표현하면 된다.

#### 정리
간단히 표현하기 위한 수단으로 비트 연산을 사용한다면 어려운 코드를 만들게 된다. 
비트 연산자는 비트 연산자로 남겨두고, 고수준 개념은 그에 합당한 고차원적인 언어로 표현하는게 옳다.

### 부차적 상세정보
테스트 코드에 본질적인 부분이 아닌 부수적인 정보가 넘쳐 흐를 때가 종종 있는데, 이를 <b>부차적 상세정보</b>(Incidental Details)냄새라 한다.

#### 개선 방법
- 핵심이 아닌 설정은 private 메서드나 셋업 메서드로 추출하라
- 적절한 인자와 서술형 이름을 사용하라.
- 한 메서드 안에서는 모두 같은 수준으로 추상화하라.

#### 정리
핵심이 아닌 코드나 정보를 도우미 메서드나 셋업 메서드로 내몰아야한다. 특히 '한 메서드 안에서는 모두 같은 수준으로 추상화하라'라는 말을 항시 기억해두면 좋다.


